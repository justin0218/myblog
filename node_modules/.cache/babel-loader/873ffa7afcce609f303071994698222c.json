{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/justin/Desktop/my/client-pc/pages/chatroom.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nimport Layout from '../components/layout';\nimport * as api from '../apis/blog';\nimport pb from \"../proto/ws_pb\";\n\nvar _default =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(_default, _React$Component);\n\n  function _default() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, _default);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(_default)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      socket: null,\n      saytext: \"\"\n    });\n\n    return _this;\n  }\n\n  _createClass(_default, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var roomid, socket;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                roomid = this.props.query.roomid;\n                socket = this.state.socket;\n                socket = new ReconnectingWebSocket(\"ws://localhost:14001/v1/ws/chatroom?roomid=\".concat(roomid));\n                socket.debug = true;\n                socket.timeoutInterval = 5400;\n\n                socket.onopen = function () {//socket.send(\"发送数据\");\n                };\n\n                socket.onmessage = function (evt) {\n                  var received_msg = evt.data;\n                  console.log(evt); // let commentData = await readStream(commentRes.data);\n                  // let commentMessage = protobuf.blog_comments.deserializeBinary(commentData);\n                  // return commentMessage.toObject()\n                };\n\n                socket.onclose = function () {\n                  console.log(\"链接已关闭\");\n                };\n\n                this.setState({\n                  socket: socket\n                });\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"subMitComment\",\n    value: function () {\n      var _subMitComment = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(event) {\n        var socket, e, saytext, baseMsg, msg;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                socket = this.state.socket;\n                e = event || window.event;\n\n                if (e && e.keyCode == 13) {\n                  //回车键的键值为13\n                  saytext = this.state.saytext;\n                  console.log(saytext);\n                  baseMsg = new pb.ws_msg_base();\n                  msg = new pb.chat_content();\n                  msg.setMsg(saytext);\n                  baseMsg.setData(saytext);\n                  socket.send(baseMsg.serializeBinary());\n                  this.setState({\n                    saytext: \"\"\n                  });\n                }\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function subMitComment(_x) {\n        return _subMitComment.apply(this, arguments);\n      }\n\n      return subMitComment;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var saytext = this.state.saytext;\n      return React.createElement(Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 60\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"jsx-1700692321\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 61\n        },\n        __self: this\n      }, React.createElement(\"ul\", {\n        style: {\n          listStyle: \"none\"\n        },\n        className: \"jsx-1700692321\" + \" \" + \"chatlist\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62\n        },\n        __self: this\n      }, React.createElement(\"li\", {\n        className: \"jsx-1700692321\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 63\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"jsx-1700692321\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 64\n        },\n        __self: this\n      }, \"2020-04-29 00:00:00\"), React.createElement(\"div\", {\n        style: {\n          height: 12\n        },\n        className: \"jsx-1700692321\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"jsx-1700692321\" + \" \" + \"chatbox\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 66\n        },\n        __self: this\n      }, \"\\u963F\\u8428\\u7B54\\u4E86\\u51E0\\u9053\\u963F\\u65AF\\u8FBE\\u963F\\u65AF\\u8FBE\\u5783\\u573E\\u888B\\u4E86\\u963F\\u8428\\u7B54\\u4E86\\u51E0\\u9053\\u963F\\u65AF\\u8FBE\\u963F\\u65AF\\u8FBE\\u5783\\u573E\\u888B\\u4E86\\u963F\\u8428\\u7B54\\u4E86\\u51E0\\u9053\\u963F\\u65AF\\u8FBE\\u963F\\u65AF\\u8FBE\\u5783\\u573E\\u888B\\u4E86\\u963F\\u8428\\u7B54\\u4E86\\u51E0\\u9053\\u963F\\u65AF\\u8FBE\\u963F\\u65AF\\u8FBE\\u5783\\u573E\\u888B\\u4E86\")), React.createElement(\"li\", {\n        className: \"jsx-1700692321\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 68\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"jsx-1700692321\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69\n        },\n        __self: this\n      }, \"2020-04-29 00:00:00\"), React.createElement(\"div\", {\n        style: {\n          height: 12\n        },\n        className: \"jsx-1700692321\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"jsx-1700692321\" + \" \" + \"chatbox\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }, \"\\u963F\\u8428\\u7B54\\u4E86\\u51E0\\u9053\\u963F\\u65AF\\u8FBE\\u963F\\u65AF\\u8FBE\\u5783\\u573E\\u888B\\u4E86\"))), React.createElement(\"input\", {\n        value: saytext,\n        onChange: function onChange(e) {\n          _this2.setState({\n            \"saytext\": e.target.value\n          });\n        },\n        onKeyUp: this.subMitComment.bind(this),\n        className: \"jsx-1700692321\" + \" \" + \"chatcontent\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 74\n        },\n        __self: this\n      })), React.createElement(_JSXStyle, {\n        id: \"1700692321\",\n        __self: this\n      }, \".chatbox.jsx-1700692321{color:#333;border-radius:5px;}.chatlist.jsx-1700692321 li.jsx-1700692321:nth-child(1){margin-top:0px;}.chatlist.jsx-1700692321 li.jsx-1700692321{background:#fff;box-shadow:3px 4px 4px #ccc;border-radius:5px;padding:15px;margin-top:15px;}.chatlist.jsx-1700692321 li.jsx-1700692321 span.jsx-1700692321{font-size:14px;}.chatcontent.jsx-1700692321{width:97%;margin-top:50px;color:#333;font-size:18px;padding:10px;border:solid #ccc;}.chatcontent.jsx-1700692321:hover{outline:none;}.chatcontent.jsx-1700692321:focus{outline:none;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qdXN0aW4vRGVza3RvcC9teS9jbGllbnQtcGMvcGFnZXMvY2hhdHJvb20uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBNkVvQixBQUd3QixBQUlJLEFBR0MsQUFPRCxBQUdMLEFBUUcsQUFHQSxVQVZHLENBakJFLEVBeUJwQixBQUdBLEVBeEJBLEFBVUEsQ0FQOEIsVUFXakIsR0FqQmIsUUFrQmlCLE9BWEcsUUFZTCxVQVhBLEdBWUssVUFYRixRQVlsQixRQVhBIiwiZmlsZSI6Ii9Vc2Vycy9qdXN0aW4vRGVza3RvcC9teS9jbGllbnQtcGMvcGFnZXMvY2hhdHJvb20uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTGF5b3V0IGZyb20gJy4uL2NvbXBvbmVudHMvbGF5b3V0JztcbmltcG9ydCAqIGFzIGFwaSBmcm9tICcuLi9hcGlzL2Jsb2cnO1xuaW1wb3J0IHBiIGZyb20gXCIuLi9wcm90by93c19wYlwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBhc3luYyBnZXRJbml0aWFsUHJvcHMoeyByZXEscXVlcnksanNvblBhZ2VSZXMgfSkge1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9IHJlcSA/IHJlcS5oZWFkZXJzWyd1c2VyLWFnZW50J10gOiBuYXZpZ2F0b3IudXNlckFnZW50XG4gICAgcmV0dXJuIHsgdXNlckFnZW50LHF1ZXJ5LGpzb25QYWdlUmVzIH1cbiAgfVxuXG4gIHN0YXRlID0ge1xuICAgIHNvY2tldDpudWxsLFxuICAgIHNheXRleHQ6XCJcIlxuICB9XG5cbiAgYXN5bmMgY29tcG9uZW50RGlkTW91bnQoKXtcbiAgICBjb25zdCB7cm9vbWlkfSA9IHRoaXMucHJvcHMucXVlcnk7XG4gICAgbGV0IHtzb2NrZXR9ID0gdGhpcy5zdGF0ZTtcbiAgICBzb2NrZXQgPSBuZXcgUmVjb25uZWN0aW5nV2ViU29ja2V0KGB3czovL2xvY2FsaG9zdDoxNDAwMS92MS93cy9jaGF0cm9vbT9yb29taWQ9JHtyb29taWR9YCk7XG4gICAgc29ja2V0LmRlYnVnID0gdHJ1ZTtcbiAgICBzb2NrZXQudGltZW91dEludGVydmFsID0gNTQwMDtcbiAgICBzb2NrZXQub25vcGVuID0gZnVuY3Rpb24oKXtcbiAgICAgIC8vc29ja2V0LnNlbmQoXCLlj5HpgIHmlbDmja5cIik7XG4gICAgfTtcbiAgICAgICAgXG4gICAgc29ja2V0Lm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChldnQpIFxuICAgIHsgXG4gICAgICB2YXIgcmVjZWl2ZWRfbXNnID0gZXZ0LmRhdGE7XG4gICAgICBjb25zb2xlLmxvZyhldnQpXG4gICAgICAvLyBsZXQgY29tbWVudERhdGEgPSBhd2FpdCByZWFkU3RyZWFtKGNvbW1lbnRSZXMuZGF0YSk7XG4gICAgICAvLyBsZXQgY29tbWVudE1lc3NhZ2UgPSBwcm90b2J1Zi5ibG9nX2NvbW1lbnRzLmRlc2VyaWFsaXplQmluYXJ5KGNvbW1lbnREYXRhKTtcbiAgICAgIC8vIHJldHVybiBjb21tZW50TWVzc2FnZS50b09iamVjdCgpXG4gICAgfTtcbiAgICAgICAgXG4gICAgc29ja2V0Lm9uY2xvc2UgPSBmdW5jdGlvbigpXG4gICAgeyBcbiAgICAgIGNvbnNvbGUubG9nKFwi6ZO+5o6l5bey5YWz6ZetXCIpXG4gICAgfTtcbiAgICB0aGlzLnNldFN0YXRlKHtzb2NrZXR9KTtcbiAgfVxuXG4gIGFzeW5jIHN1Yk1pdENvbW1lbnQoZXZlbnQpe1xuICAgIGxldCB7c29ja2V0fSA9IHRoaXMuc3RhdGU7XG4gICAgdmFyIGUgPSBldmVudCB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgaWYgKGUgJiYgZS5rZXlDb2RlID09IDEzKSB7IC8v5Zue6L2m6ZSu55qE6ZSu5YC85Li6MTNcbiAgICAgIGxldCB7c2F5dGV4dH0gPSB0aGlzLnN0YXRlO1xuICAgICAgY29uc29sZS5sb2coc2F5dGV4dCk7XG4gICAgICBsZXQgYmFzZU1zZyA9IG5ldyBwYi53c19tc2dfYmFzZSgpO1xuICAgICAgbGV0IG1zZyA9IG5ldyBwYi5jaGF0X2NvbnRlbnQoKTtcbiAgICAgIG1zZy5zZXRNc2coc2F5dGV4dCk7XG4gICAgICBiYXNlTXNnLnNldERhdGEoc2F5dGV4dCk7XG4gICAgICBzb2NrZXQuc2VuZChiYXNlTXNnLnNlcmlhbGl6ZUJpbmFyeSgpKTtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe3NheXRleHQ6XCJcIn0pXG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGxldCB7c2F5dGV4dH0gPSB0aGlzLnN0YXRlO1xuICAgIHJldHVybiAoXG4gICAgICA8TGF5b3V0PlxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDx1bCBzdHlsZT17e2xpc3RTdHlsZTpcIm5vbmVcIn19IGNsYXNzTmFtZT1cImNoYXRsaXN0XCI+XG4gICAgICAgICAgICA8bGk+XG4gICAgICAgICAgICAgIDxzcGFuPjIwMjAtMDQtMjkgMDA6MDA6MDA8L3NwYW4+XG4gICAgICAgICAgICAgIDxkaXYgc3R5bGU9e3toZWlnaHQ6MTJ9fT48L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjaGF0Ym94XCI+6Zi/6JCo562U5LqG5Yeg6YGT6Zi/5pav6L6+6Zi/5pav6L6+5Z6D5Zy+6KKL5LqG6Zi/6JCo562U5LqG5Yeg6YGT6Zi/5pav6L6+6Zi/5pav6L6+5Z6D5Zy+6KKL5LqG6Zi/6JCo562U5LqG5Yeg6YGT6Zi/5pav6L6+6Zi/5pav6L6+5Z6D5Zy+6KKL5LqG6Zi/6JCo562U5LqG5Yeg6YGT6Zi/5pav6L6+6Zi/5pav6L6+5Z6D5Zy+6KKL5LqGPC9kaXY+XG4gICAgICAgICAgICA8L2xpPlxuICAgICAgICAgICAgPGxpPlxuICAgICAgICAgICAgICA8c3Bhbj4yMDIwLTA0LTI5IDAwOjAwOjAwPC9zcGFuPlxuICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7aGVpZ2h0OjEyfX0+PC9kaXY+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY2hhdGJveFwiPumYv+iQqOetlOS6huWHoOmBk+mYv+aWr+i+vumYv+aWr+i+vuWeg+Wcvuiii+S6hjwvZGl2PlxuICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICA8L3VsPlxuICAgICAgICAgIDxpbnB1dCBjbGFzc05hbWU9XCJjaGF0Y29udGVudFwiIHZhbHVlPXtzYXl0ZXh0fSBvbkNoYW5nZT17KGUpPT57XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcInNheXRleHRcIjplLnRhcmdldC52YWx1ZX0pXG4gICAgICAgICAgfX0gb25LZXlVcD17dGhpcy5zdWJNaXRDb21tZW50LmJpbmQodGhpcyl9IC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8c3R5bGUganN4PntgXG4gICAgICAgICAgLmNoYXRib3h7XG4gICAgICAgICAgICBjb2xvcjogIzMzMztcbiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgICAgICAgICB9XG4gICAgICAgICAgLmNoYXRsaXN0IGxpOm50aC1jaGlsZCgxKXtcbiAgICAgICAgICAgIG1hcmdpbi10b3A6IDBweDtcbiAgICAgICAgICB9XG4gICAgICAgICAgLmNoYXRsaXN0IGxpIHtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZmY7XG4gICAgICAgICAgICBib3gtc2hhZG93OiAzcHggNHB4IDRweCAjY2NjO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4O1xuICAgICAgICAgICAgcGFkZGluZzogMTVweDtcbiAgICAgICAgICAgIG1hcmdpbi10b3A6IDE1cHg7XG4gICAgICAgICAgfVxuICAgICAgICAgIC5jaGF0bGlzdCBsaSBzcGFue1xuICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICAgIH1cbiAgICAgICAgICAuY2hhdGNvbnRlbnR7XG4gICAgICAgICAgICB3aWR0aDogOTclO1xuICAgICAgICAgICAgbWFyZ2luLXRvcDogNTBweDtcbiAgICAgICAgICAgIGNvbG9yOiAjMzMzO1xuICAgICAgICAgICAgZm9udC1zaXplOiAxOHB4O1xuICAgICAgICAgICAgcGFkZGluZzogMTBweDtcbiAgICAgICAgICAgIGJvcmRlcjogc29saWQgI2NjYztcbiAgICAgICAgICB9XG4gICAgICAgICAgLmNoYXRjb250ZW50OmhvdmVye1xuICAgICAgICAgICAgb3V0bGluZTogbm9uZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLmNoYXRjb250ZW50OmZvY3Vze1xuICAgICAgICAgICAgb3V0bGluZTogbm9uZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgYH08L3N0eWxlPlxuICAgICAgPC9MYXlvdXQ+XG4gICAgKVxuXG4gICBcblxuICB9XG59XG5cblxuIl19 */\\n/*@ sourceURL=/Users/justin/Desktop/my/client-pc/pages/chatroom.js */\"));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(_ref) {\n        var req, query, jsonPageRes, userAgent;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                req = _ref.req, query = _ref.query, jsonPageRes = _ref.jsonPageRes;\n                userAgent = req ? req.headers['user-agent'] : navigator.userAgent;\n                return _context3.abrupt(\"return\", {\n                  userAgent: userAgent,\n                  query: query,\n                  jsonPageRes: jsonPageRes\n                });\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function getInitialProps(_x2) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return _default;\n}(React.Component);\n\nexport { _default as default };","map":{"version":3,"sources":["/Users/justin/Desktop/my/client-pc/pages/chatroom.js"],"names":["Layout","api","pb","socket","saytext","roomid","props","query","state","ReconnectingWebSocket","debug","timeoutInterval","onopen","onmessage","evt","received_msg","data","console","log","onclose","setState","event","e","window","keyCode","baseMsg","ws_msg_base","msg","chat_content","setMsg","setData","send","serializeBinary","listStyle","height","target","value","subMitComment","bind","req","jsonPageRes","userAgent","headers","navigator","React","Component"],"mappings":"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","sourcesContent":["import Layout from '../components/layout';\nimport * as api from '../apis/blog';\nimport pb from \"../proto/ws_pb\";\n\nexport default class extends React.Component {\n  static async getInitialProps({ req,query,jsonPageRes }) {\n    const userAgent = req ? req.headers['user-agent'] : navigator.userAgent\n    return { userAgent,query,jsonPageRes }\n  }\n\n  state = {\n    socket:null,\n    saytext:\"\"\n  }\n\n  async componentDidMount(){\n    const {roomid} = this.props.query;\n    let {socket} = this.state;\n    socket = new ReconnectingWebSocket(`ws://localhost:14001/v1/ws/chatroom?roomid=${roomid}`);\n    socket.debug = true;\n    socket.timeoutInterval = 5400;\n    socket.onopen = function(){\n      //socket.send(\"发送数据\");\n    };\n        \n    socket.onmessage = function (evt) \n    { \n      var received_msg = evt.data;\n      console.log(evt)\n      // let commentData = await readStream(commentRes.data);\n      // let commentMessage = protobuf.blog_comments.deserializeBinary(commentData);\n      // return commentMessage.toObject()\n    };\n        \n    socket.onclose = function()\n    { \n      console.log(\"链接已关闭\")\n    };\n    this.setState({socket});\n  }\n\n  async subMitComment(event){\n    let {socket} = this.state;\n    var e = event || window.event;\n    if (e && e.keyCode == 13) { //回车键的键值为13\n      let {saytext} = this.state;\n      console.log(saytext);\n      let baseMsg = new pb.ws_msg_base();\n      let msg = new pb.chat_content();\n      msg.setMsg(saytext);\n      baseMsg.setData(saytext);\n      socket.send(baseMsg.serializeBinary());\n      this.setState({saytext:\"\"})\n    }\n  }\n\n  render() {\n    let {saytext} = this.state;\n    return (\n      <Layout>\n        <div>\n          <ul style={{listStyle:\"none\"}} className=\"chatlist\">\n            <li>\n              <span>2020-04-29 00:00:00</span>\n              <div style={{height:12}}></div>\n              <div className=\"chatbox\">阿萨答了几道阿斯达阿斯达垃圾袋了阿萨答了几道阿斯达阿斯达垃圾袋了阿萨答了几道阿斯达阿斯达垃圾袋了阿萨答了几道阿斯达阿斯达垃圾袋了</div>\n            </li>\n            <li>\n              <span>2020-04-29 00:00:00</span>\n              <div style={{height:12}}></div>\n              <div className=\"chatbox\">阿萨答了几道阿斯达阿斯达垃圾袋了</div>\n            </li>\n          </ul>\n          <input className=\"chatcontent\" value={saytext} onChange={(e)=>{\n            this.setState({\"saytext\":e.target.value})\n          }} onKeyUp={this.subMitComment.bind(this)} />\n        </div>\n        <style jsx>{`\n          .chatbox{\n            color: #333;\n            border-radius: 5px;\n          }\n          .chatlist li:nth-child(1){\n            margin-top: 0px;\n          }\n          .chatlist li {\n            background: #fff;\n            box-shadow: 3px 4px 4px #ccc;\n            border-radius: 5px;\n            padding: 15px;\n            margin-top: 15px;\n          }\n          .chatlist li span{\n            font-size: 14px;\n          }\n          .chatcontent{\n            width: 97%;\n            margin-top: 50px;\n            color: #333;\n            font-size: 18px;\n            padding: 10px;\n            border: solid #ccc;\n          }\n          .chatcontent:hover{\n            outline: none;\n          }\n          .chatcontent:focus{\n            outline: none;\n          }\n\n        `}</style>\n      </Layout>\n    )\n\n   \n\n  }\n}\n\n\n"]},"metadata":{},"sourceType":"module"}